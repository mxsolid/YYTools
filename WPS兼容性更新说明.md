# YY运单匹配工具 - WPS兼容性更新说明

## 🚀 更新版本：v1.2 (2025-01-22)

### 🎯 主要更新内容

#### 1. **WPS表格完全兼容** 📊
- **自动检测**：优先连接WPS表格，如果WPS不可用则连接Excel
- **无缝切换**：支持WPS表格和Excel的无缝切换使用
- **统一体验**：在WPS和Excel中提供完全一致的功能体验

**检测顺序：**
1. 首先尝试连接WPS表格 (`Ket.Application`)
2. 如果WPS连接失败，尝试连接Excel (`Excel.Application`)
3. 如果都连接失败，创建新的Excel实例

#### 2. **全新列选择功能** 🎯
参考方方格子工具箱的设计，提供两种选择方式：

##### **方式1：手动输入**
- 直接在文本框输入列号（如A、B、AA、AB等）
- 实时验证输入格式，错误时文本框显示红色背景
- 支持所有有效的Excel列号格式

##### **方式2：从表格选择**
- 点击"从表格选择"按钮
- 在WPS或Excel中点击任意单元格
- 自动获取该单元格的列号并填入

#### 3. **增强的错误处理** 🛡️
- 智能应用程序检测和连接
- 友好的错误提示信息
- 连接失败时的详细说明

### 🛠️ 技术实现

#### WPS兼容性检测
```csharp
// 首先尝试连接到WPS表格
try
{
    excelApp = (Excel.Application)Marshal.GetActiveObject("Ket.Application");
    Debug.WriteLine("连接到WPS表格成功");
}
catch
{
    // 如果WPS连接失败，尝试连接到Excel
    excelApp = (Excel.Application)Marshal.GetActiveObject("Excel.Application");
    Debug.WriteLine("连接到Excel成功");
}
```

#### 列选择对话框
```csharp
// 创建专用的列选择窗体
ColumnSelectionForm selectionForm = new ColumnSelectionForm(currentColumn);
if (selectionForm.ShowDialog() == DialogResult.OK)
{
    targetTextBox.Text = selectionForm.SelectedColumn;
}
```

### 📋 使用方法

#### 启动方式（与之前相同）
1. 打开WPS表格或Excel，加载数据文件
2. 运行 `TestProgram.exe`
3. 选择"1. 启动匹配工具"

#### 新的列选择功能
1. **手动输入**：
   - 直接在列号文本框中输入（如A、B、AA）
   - 输入错误时文本框背景变红色提示
   - 支持所有标准Excel列号格式

2. **从表格选择**：
   - 点击任意"选择"按钮
   - 在弹出的对话框中点击"从表格选择"
   - 在WPS或Excel中点击目标列的任意单元格
   - 点击确定，列号自动填入

### 🎨 界面改进

#### 列选择对话框特性
- **智能验证**：实时验证输入的列号格式
- **视觉反馈**：错误输入时红色背景提示
- **双重选择**：支持手动输入和点击选择
- **快捷操作**：回车确认，ESC取消

#### 错误提示优化
- 连接失败时显示详细的解决方案
- 支持的软件版本信息
- 操作步骤指导

### 🔄 兼容性对比

| 功能 | v1.1版本 | v1.2版本 |
|------|----------|----------|
| Excel支持 | ✅ 完全支持 | ✅ 完全支持 |
| WPS表格支持 | ❌ 不支持 | ✅ **新增支持** |
| 列选择方式 | 简单点击 | ✅ **双重选择** |
| 错误处理 | 基础提示 | ✅ **智能检测** |
| 用户体验 | 良好 | ✅ **显著提升** |

### 🚨 注意事项

#### WPS表格要求
- **版本**：WPS Office 2016 及以上版本
- **设置**：需要启用"开发工具"选项卡（通常默认启用）
- **权限**：可能需要信任宏和外部应用程序连接

#### Excel要求（不变）
- **版本**：Excel 2010 及以上版本
- **依赖**：Microsoft Office Interop Excel

#### 故障排除
1. **"无法连接到Excel或WPS表格"**：
   - 确保WPS表格或Excel已打开
   - 确保已打开包含数据的文件
   - 重启WPS/Excel后重试

2. **列选择失败**：
   - 确保在表格中选中了有效单元格
   - 避免选择合并单元格
   - 重新尝试手动输入列号

3. **性能问题**：
   - WPS表格中大文件可能比Excel稍慢
   - 建议关闭不必要的WPS插件
   - 数据量过大时建议分批处理

### 🎉 更新总结

这次更新主要解决了WPS用户的兼容性问题：

✅ **完全支持WPS表格** - 自动检测和连接  
✅ **智能应用程序切换** - WPS/Excel无缝切换  
✅ **全新列选择功能** - 手动输入+点击选择  
✅ **增强错误处理** - 更友好的提示信息  
✅ **参考方方格子设计** - 提升用户体验  

现在WPS用户可以享受与Excel用户完全相同的功能体验！

### 📖 使用技巧

#### 快速操作
1. **批量设置列号**：可以依次点击各个"选择"按钮快速设置所有列
2. **复制粘贴列号**：支持从其他地方复制列号直接粘贴到文本框
3. **键盘操作**：在列选择对话框中支持回车确认、ESC取消

#### 最佳实践
1. **数据准备**：确保WPS/Excel中的数据格式正确
2. **列验证**：设置完列号后先检查一下是否正确
3. **备份数据**：处理前建议备份原始文件

---
**更新时间**：2025年1月22日  
**版本号**：v1.2  
**开发者**：YYTools Team  
**特别感谢**：感谢用户反馈WPS兼容性需求 