# YY工具 v2.6 更新说明

## 版本信息
- **版本号**: 2.6.0.0
- **更新日期**: 2025年
- **目标框架**: .NET Framework 4.8
- **兼容性**: Windows 7 SP1及以上，Excel 2010+，WPS Office

## 🚀 主要功能更新

### 1. 智能列选择系统
- **自动列识别**: 根据关键字智能匹配最佳列
  - 运单号列：自动识别包含"运单"、"快递"、"物流"、"单号"等关键字的列
  - 商品编码列：自动识别包含"编码"、"商品"、"产品"等关键字的列
  - 商品名称列：自动识别包含"名称"、"品名"等关键字的列
- **优先级匹配**: 使用评分系统，优先选择最匹配的列
- **智能验证**: 实时验证列选择的有效性

### 2. 列搜索和预览功能
- **智能搜索**: 支持多种分隔符搜索（空格、逗号、分号、括号等）
- **预览数据**: 显示列标题和第一行非空数据作为预览
- **列信息显示**: 显示总行数、总列数、估算文件大小等统计信息

### 3. 性能优化和错误处理
- **批量处理**: 使用分批读取和写入，提高大数据量处理性能
- **内存优化**: 优化Excel应用程序设置，减少内存占用
- **进度报告**: 实时显示处理进度和状态信息
- **错误恢复**: 完善的异常处理和日志记录
- **性能警告**: 大数据量时自动给出性能警告

### 4. 界面优化
- **布局改善**: 重新设计界面布局，增加间距和美观性
- **图标更新**: 添加emoji图标，提升用户体验
- **响应式设计**: 优化控件大小和位置
- **状态反馈**: 列选择验证结果的可视化反馈

### 5. 配置系统增强
- **智能设置**: 新增智能列选择、列预览、列搜索等开关
- **性能配置**: 可配置批处理大小、进度报告等参数
- **持久化存储**: 所有设置自动保存到用户配置目录

## 📁 新增文件

### 1. SmartColumnService.cs
- **功能**: 智能列选择服务
- **主要类**: `SmartColumnService`
- **核心方法**:
  - `GetColumnInfos()`: 获取工作表列信息
  - `SmartMatchColumns()`: 智能匹配列
  - `SearchColumns()`: 列搜索功能
  - `ValidateColumnSelection()`: 列选择验证

### 2. 更新的核心文件
- **DataModels.cs**: 新增 `ColumnInfo`、`SmartColumnRule` 类
- **AppSettings.cs**: 新增智能列选择和性能配置选项
- **ExcelHelper.cs**: 新增性能优化和错误处理方法
- **MatchService.cs**: 重构为批量处理模式
- **MatchForm.cs**: 集成智能列选择功能

## 🔧 技术改进

### 1. 架构优化
- **服务层分离**: 将列选择逻辑分离到独立服务
- **缓存机制**: 实现列信息缓存，提高性能
- **批量处理**: 重构数据处理逻辑，支持大数据量

### 2. 错误处理
- **异常捕获**: 完善的try-catch异常处理
- **日志记录**: 详细的日志记录系统
- **用户友好**: 友好的错误提示和恢复机制

### 3. 性能优化
- **Excel优化**: 自动优化Excel应用程序设置
- **内存管理**: 分批处理减少内存占用
- **进度监控**: 实时进度报告和性能监控

## 📋 使用方法

### 1. 智能列选择
1. 选择工作簿和工作表后，系统自动识别最佳列
2. 运单号列、商品编码列、商品名称列会自动选择
3. 可以手动调整列选择，系统会验证选择的有效性

### 2. 列搜索
1. 在列下拉框中输入关键字
2. 支持多种分隔符：空格、逗号、分号、括号等
3. 系统会过滤显示匹配的列

### 3. 性能监控
1. 系统会自动检测工作表大小
2. 大数据量时会给出性能警告
3. 可以调整批处理大小等性能参数

## 🚨 注意事项

### 1. 系统要求
- Windows 7 SP1及以上操作系统
- .NET Framework 4.8
- Excel 2010或WPS Office

### 2. 性能建议
- 建议在匹配前备份数据
- 大数据量（>10万行）时注意性能影响
- 可以调整批处理大小优化性能

### 3. 兼容性
- 支持Excel 2010及以上版本
- 支持WPS Office
- 支持32位和64位系统

## 📦 部署说明

### 1. 构建
```bash
# Windows环境
msbuild YYTools.csproj /p:Configuration=Release

# 或使用打包脚本
build_release.bat
```

### 2. 安装
1. 以管理员身份运行"安装.bat"
2. 等待COM组件注册完成
3. 桌面会创建快捷方式

### 3. 卸载
1. 以管理员身份运行"卸载.bat"
2. 等待COM组件注销完成

## 🔍 故障排除

### 1. 常见问题
- **COM组件注册失败**: 确保以管理员身份运行安装脚本
- **列选择无效**: 检查列标题是否包含必要关键字
- **性能问题**: 调整批处理大小，检查工作表大小

### 2. 日志查看
- 日志文件位置：`%APPDATA%\YYTools\Logs\`
- 日志文件名格式：`YYTools_YYYY-MM-DD.log`

### 3. 技术支持
- 作者：皮皮熊
- 邮箱：oyxo@qq.com
- 请提供详细的错误信息和日志文件

## 📈 性能数据

### 1. 基准测试
- **小数据量**（<1万行）: 处理时间 < 1秒
- **中等数据量**（1-10万行）: 处理时间 1-10秒
- **大数据量**（10-50万行）: 处理时间 10-60秒

### 2. 内存使用
- **优化前**: 可能占用大量内存
- **优化后**: 分批处理，内存使用稳定

### 3. 稳定性
- **错误处理**: 完善的异常处理机制
- **恢复能力**: 支持任务取消和恢复
- **日志记录**: 详细的操作日志

## 🎯 未来规划

### 1. 短期目标
- 支持更多Excel版本
- 优化大数据量处理性能
- 增加更多列类型识别

### 2. 长期目标
- 支持数据库数据源
- 云端部署支持
- 机器学习优化列识别

---

**版本**: 2.6.0.0  
**更新日期**: 2025年  
**作者**: 皮皮熊  
**技术支持**: oyxo@qq.com